import React, { useState } from "react";

// 🔹 기본 사용법
// 1) 이 파일을 그대로 배포(예: Vercel/Netlify)하면 원페이지 사이트로 동작합니다.
// 2) 아래 FORM_ENDPOINT 를 Formspree(https://formspree.io)에서 발급받은 본인 엔드포인트로 교체하세요.
//    예) https://formspree.io/f/abcdwxyz
// 3) 카카오톡, 전화번호, 사업자정보 등은 하단의 TODO 영역을 수정하세요.

const FORM_ENDPOINT = "https://formspree.io/f/your-endpoint"; // TODO: 본인 Formspree 엔드포인트로 교체
const PHONE_RE = /^([0-9\-\s]{9,})$/;

export default function LeakDrainContactSite() {
  const [status, setStatus] = useState({ state: "idle", message: "" });
  const [form, setForm] = useState({
    name: "",
    phone: "",
    region: "",
    service: "누수탐지",
    preferredTime: "",
    message: "",
    agree: false,
  });

  const services = [
    { key: "누수탐지", desc: "열화상/청음기/가스추적 등 장비 기반 정밀 탐지" },
    { key: "하수구막힘", desc: "고압세척/스프링/와이어·카메라 점검" },
    { key: "배관세척", desc: "주방·욕실 배관 기름때/스케일 제거" },
    { key: "악취차단", desc: "트랩/환풍/배수 기밀 점검 및 개선" },
  ];

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {
    const { name, value, type } = e.target as HTMLInputElement;
    const checked = (e.target as HTMLInputElement).checked;
    setForm((prev) => ({ ...prev, [name]: type === "checkbox" ? checked : value }));
  };

  const validate = () => {
    if (!form.name.trim()) return "성함을 입력해주세요.";
    if (!PHONE_RE.test(form.phone)) return "연락처는 숫자/하이픈으로 9자 이상 입력해주세요.";
    if (!form.region.trim()) return "지역(동/구)을 입력해주세요.";
    if (!form.message.trim()) return "상세 증상을 간단히 적어주세요.";
    if (!form.agree) return "개인정보 수집·이용에 동의해주세요.";
    return null;
  };

  const onSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setStatus({ state: "submitting", message: "전송 중입니다…" });
    const err = validate();
    if (err) {
      setStatus({ state: "error", message: err });
      return;
    }

    try {
      const payload = new FormData();
      Object.entries(form).forEach(([k, v]) => payload.append(k, String(v)));

      const res = await fetch(FORM_ENDPOINT, { method: "POST", body: payload, headers: { Accept: "application/json" } });

      if (res.ok) {
        setStatus({ state: "success", message: "접수되었습니다! 곧 연락드리겠습니다." });
        setForm({ name: "", phone: "", region: "", service: "누수탐지", preferredTime: "", message: "", agree: false });
      } else {
        const data = await res.json().catch(() => ({} as any));
        setStatus({ state: "error", message: (data as any)?.error || "전송 중 문제가 발생했습니다. 전화/카톡으로 문의해주세요." });
      }
    } catch (e) {
      setStatus({ state: "error", message: "네트워크 오류입니다. 잠시 후 다시 시도해주세요." });
    }
  };

  return (
    <div className="min-h-screen bg-neutral-50 text-neutral-900">
      {/* 헤더 */}
      <header className="sticky top-0 z-40 backdrop-blur bg-white/80 border-b border-neutral-200">
        <div className="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between">
          <div className="flex items-center gap-2">
            <span className="inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-emerald-900 text-white font-semibold">水</span>
            <h1 className="text-lg font-bold">누수·하수구 긴급센터</h1>
          </div>
          <div className="flex items-center gap-2">
            <a href="tel:010-0000-0000" className="px-3 py-2 rounded-2xl border border-neutral-300 hover:bg-neutral-100 text-sm">전화</a>
            <a href="#contact" className="px-3 py-2 rounded-2xl bg-emerald-900 text-white hover:bg-emerald-800 text-sm">무료 상담</a>
          </div>
        </div>
      </header>

      {/* 히어로 */}
      <section className="relative overflow-hidden">
        <div className="absolute inset-0 -z-10 bg-gradient-to-b from-neutral-100 via-white to-neutral-50" />
        <div className="max-w-5xl mx-auto px-4 py-12 md:py-16 grid md:grid-cols-2 gap-8 items-center">
          <div>
            <p className="text-xs tracking-widest text-neutral-500">LEAK · DRAIN · EMERGENCY</p>
            <h2 className="mt-2 text-3xl md:text-4xl font-extrabold leading-tight">
              누수탐지·하수구 막힘<br />
              <span className="inline-block mt-1 bg-emerald-900 text-white px-2 py-1 rounded-xl">무료 상담</span>으로 빠르게 해결하세요
            </h2>
            <p className="mt-4 text-neutral-600">
              24시간 접수. 사진/영상 보내주시면 1차 원인 진단 후 예상비용과 소요시간을 안내드립니다.
            </p>
            <div className="mt-6 flex flex-wrap gap-2">
              {services.map((s) => (
                <span key={s.key} className="text-xs px-2 py-1 rounded-xl border border-neutral-300">
                  {s.key}
                </span>
              ))}
            </div>
            <div className="mt-6 flex gap-3">
              <a href="#contact" className="px-4 py-2 rounded-2xl bg-emerald-900 text-white hover:bg-emerald-800">상담 신청</a>
              <a href="https://pf.kakao.com/_yourchannel" target="_blank" rel="noreferrer" className="px-4 py-2 rounded-2xl border border-neutral-300 hover:bg-neutral-100">카카오톡 문의</a>
            </div>
            <p className="mt-3 text-xs text-neutral-500">※ 카카오채널/전화번호는 수정하세요.</p>
          </div>
          <div className="md:pl-6">
            <div className="rounded-3xl border border-neutral-200 bg-white shadow-sm p-5">
              <h3 className="text-lg font-semibold">처리 프로세스</h3>
              <ol className="mt-3 space-y-3 text-sm text-neutral-700">
                <li><b>1) 증상 접수</b> — 사진/영상/주소(동·구) 전달</li>
                <li><b>2) 1차 진단</b> — 장비 투입 필요 여부/예상비용 안내</li>
                <li><b>3) 현장 출동</b> — 청음·가스추적·열화상·내시경 등</li>
                <li><b>4) 처리·보수</b> — 막힘 해소/배관세척/누수보수</li>
                <li><b>5) 결과 보고</b> — 전·후 사진/재발 방지 팁 제공</li>
              </ol>
            </div>
          </div>
        </div>
      </section>

      {/* 카카오 상담톡 이벤트 배너 */}
      <section className="max-w-5xl mx-auto px-4">
        <div className="rounded-3xl border border-emerald-200 bg-emerald-50 p-6 text-emerald-900 shadow-sm">
          <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
              <h3 className="text-xl font-bold">카카오 상담톡 추가 이벤트</h3>
              <p className="mt-1 text-sm">카카오 채널 추가 후 상담 예약 시 <b>즉시 1만원 할인</b> 또는 <b>배관 내시경 점검 무료</b> (택1)</p>
              <p className="text-xs mt-1 opacity-80">※ 현장 및 증상에 따라 적용 항목 상이할 수 있습니다.</p>
            </div>
            <div className="flex gap-2">
              <a href="https://pf.kakao.com/_yourchannel" target="_blank" rel="noreferrer" className="px-4 py-2 rounded-2xl bg-emerald-900 text-white hover:bg-emerald-800">카카오 채널 추가</a>
              <a href="#contact" className="px-4 py-2 rounded-2xl border border-emerald-300 text-emerald-900 hover:bg-emerald-100">상담 예약</a>
            </div>
          </div>
        </div>
      </section>

      {/* 서비스 카드 */}
      <section className="max-w-5xl mx-auto px-4 py-10">
        <h3 className="text-xl font-bold">주요 서비스</h3>
        <div className="mt-5 grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
          {services.map((s) => (
            <article key={s.key} className="rounded-3xl border border-neutral-200 bg-white shadow-sm p-5">
              <h4 className="font-semibold">{s.key}</h4>
              <p className="mt-2 text-sm text-neutral-600">{s.desc}</p>
            </article>
          ))}
        </div>
      </section>

      {/* 전/후 갤러리 */}
      <section className="max-w-5xl mx-auto px-4 pb-6">
        <h3 className="text-xl font-bold">전/후 갤러리</h3>
        <p className="mt-1 text-sm text-neutral-600">현장 사진을 교체해 사용하세요. 동일 각도 촬영이 신뢰도를 높입니다.</p>
        <div className="mt-4 grid md:grid-cols-2 gap-4">
          {[1, 2, 3, 4].map((i) => (
            <figure key={i} className="rounded-3xl border border-neutral-200 bg-white shadow-sm overflow-hidden">
              <div className="grid grid-cols-2">
                <div className="relative">
                  <img src={`/images/before-0${i}.jpg`} alt={`시공 전 사진 ${i}`} className="h-40 w-full object-cover" />
                  <figcaption className="absolute bottom-0 left-0 right-0 text-xs bg-black/50 text-white px-2 py-1">전 BEFORE</figcaption>
                </div>
                <div className="relative">
                  <img src={`/images/after-0${i}.jpg`} alt={`시공 후 사진 ${i}`} className="h-40 w-full object-cover" />
                  <figcaption className="absolute bottom-0 left-0 right-0 text-xs bg-black/50 text-white px-2 py-1">후 AFTER</figcaption>
                </div>
              </div>
            </figure>
          ))}
        </div>
      </section>

      {/* 후기 섹션 (샘플) */}
      <section className="max-w-5xl mx-auto px-4 pb-4">
        <div className="rounded-3xl border border-neutral-200 bg-white shadow-sm p-6">
          <h3 className="text-xl font-bold">고객 후기</h3>
          <p className="mt-2 text-sm text-neutral-600">네이버 블로그/카카오 채널 후기 캡처를 주기적으로 업데이트하세요.</p>
          <div className="mt-4 grid md:grid-cols-3 gap-4 text-sm">
            <blockquote className="p-4 rounded-2xl bg-neutral-50 border border-neutral-200">“밤늦게 막혔는데 빠르게 뚫어주셨어요. 비용도 합리적.” — 상무동</blockquote>
            <blockquote className="p-4 rounded-2xl bg-neutral-50 border border-neutral-200">“열화상으로 누수 위치 정확히 찾아서 벽 철거 최소화!” — 풍암동</blockquote>
            <blockquote className="p-4 rounded-2xl bg-neutral-50 border border-neutral-200">“내시경 촬영 영상 보내주셔서 안심됐습니다.” — 치평동</blockquote>
          </div>
        </div>
      </section>

      {/* 상담 폼 */}
      <section id="contact" className="max-w-5xl mx-auto px-4 py-10">
        <div className="rounded-3xl border border-neutral-200 bg-white shadow-sm p-6">
          <h3 className="text-xl font-bold">무료 상담·문의</h3>
          <p className="mt-1 text-sm text-neutral-600">빠르게 연락드리기 위해 필수 항목을 최소화했습니다. 사진/영상은 카톡으로 보내주셔도 됩니다.</p>

          <form onSubmit={onSubmit} className="mt-5 grid md:grid-cols-2 gap-4">
            <div className="flex flex-col gap-2">
              <label className="text-sm">성함 *</label>
              <input name="name" value={form.name} onChange={handleChange} className="px-3 py-2 rounded-2xl border border-neutral-300 focus:outline-none" placeholder="홍길동" />
            </div>
            <div className="flex flex-col gap-2">
              <label className="text-sm">연락처 *</label>
              <input name="phone" value={form.phone} onChange={handleChange} className="px-3 py-2 rounded-2xl border border-neutral-300 focus:outline-none" placeholder="010-1234-5678" />
            </div>
            <div className="flex flex-col gap-2">
              <label className="text-sm">지역(동/구) *</label>
              <input name="region" value={form.region} onChange={handleChange} className="px-3 py-2 rounded-2xl border border-neutral-300 focus:outline-none" placeholder="서구 상무동" />
            </div>
            <div className="flex flex-col gap-2">
              <label className="text-sm">원하시는 서비스</label>
              <select name="service" value={form.service} onChange={handleChange} className="px-3 py-2 rounded-2xl border border-neutral-300 focus:outline-none">
                {services.map((s) => (
                  <option key={s.key} value={s.key}>{s.key}</option>
                ))}
              </select>
            </div>
            <div className="md:col-span-2 flex flex-col gap-2">
              <label className="text-sm">증상/요청사항 *</label>
              <textarea name="message" value={form.message} onChange={handleChange} className="px-3 py-2 rounded-2xl border border-neutral-300 focus:outline-none min-h-[120px]" placeholder="예) 화장실 변기물이 잘 안내려가요 / 벽면 습자국 발생 / 싱크대 배수 소음" />
            </div>
            <div className="flex flex-col gap-2">
              <label className="text-sm">연락 가능 시간</label>
              <input name="preferredTime" value={form.preferredTime} onChange={handleChange} className="px-3 py-2 rounded-2xl border border-neutral-300 focus:outline-none" placeholder="예) 오늘 18~21시" />
            </div>
            <div className="flex items-start gap-2 md:col-span-2">
              <input id="agree" type="checkbox" name="agree" checked={form.agree} onChange={handleChange} className="mt-1" />
              <label htmlFor="agree" className="text-sm text-neutral-600">(필수) 문의 응대 및 서비스 제공을 위한 개인정보 수집·이용에 동의합니다.</label>
            </div>
            <div className="md:col-span-2 flex flex-wrap items-center gap-3">
              <button type="submit" disabled={status.state === "submitting"} className="px-5 py-2 rounded-2xl bg-emerald-900 text-white hover:bg-emerald-800 disabled:opacity-60">
                {status.state === "submitting" ? "전송 중…" : "상담 요청 보내기"}
              </button>
              <a href="tel:010-0000-0000" className="px-4 py-2 rounded-2xl border border-neutral-300 hover:bg-neutral-100">전화 연결</a>
              <a href="https://pf.kakao.com/_yourchannel" target="_blank" rel="noreferrer" className="px-4 py-2 rounded-2xl border border-neutral-300 hover:bg-neutral-100">카카오톡 문의</a>
              {status.message && (
                <span className={`text-sm ${status.state === "error" ? "text-red-600" : "text-emerald-600"}`}>{status.message}</span>
              )}
            </div>
          </form>
        </div>
      </section>

      {/* FAQ */}
      <section className="max-w-5xl mx-auto px-4 pb-10">
        <div className="rounded-3xl border border-neutral-200 bg-white shadow-sm p-6">
          <h3 className="text-xl font-bold">자주 묻는 질문</h3>
          <ul className="mt-3 space-y-3 text-sm text-neutral-700">
            <li>
              <b>Q. 대략적인 비용이 궁금해요.</b><br />
              A. 증상과 배관 상태에 따라 다릅니다. 사진/영상 주시면 1차 가견적을 드립니다.
            </li>
            <li>
              <b>Q. 심야/주말도 가능하나요?</b><br />
              A. 네, 24시간 접수하며 긴급 출동 가능 여부는 통화로 안내드립니다.
            </li>
            <li>
              <b>Q. 장비 탐지는 꼭 해야 하나요?</b><br />
              A. 상황에 따라 청음·열화상·가스추적·내시경 등 필요 장비만 투입합니다.
            </li>
            <li>
              <b>Q. 출장비/추가요금은 어떻게 되나요?</b><br />
              A. 지역·시간대·난이도에 따라 상이하며, <u>사전 고지 후 진행</u>합니다.
            </li>
            <li>
              <b>Q. 카드결제/현금영수증 가능해요?</b><br />
              A. 가능합니다. 세금계산서 발행도 요청하시면 처리해드립니다.
            </li>
            <li>
              <b>Q. 하자 보증은 어떻게 되나요?</b><br />
              A. 동일 증상 재발 시 <u>보증기간 내 무상 점검</u>을 원칙으로 합니다. (현장 조건별 상이)
            </li>
            <li>
              <b>Q. 누수보험/화재보험 청구 서류도 도와주시나요?</b><br />
              A. 네, 필요 시 <u>점검 리포트/사진</u> 제공을 도와드립니다.
            </li>
          </ul>
        </div>
      </section>

      {/* 네이버 지도 임베드 */}
      <section className="max-w-5xl mx-auto px-4 pb-10">
        <div className="rounded-3xl border border-neutral-200 bg-white shadow-sm overflow-hidden">
          <div className="p-6">
            <h3 className="text-xl font-bold">찾아오시는 길</h3>
            <p className="mt-1 text-sm text-neutral-600">
              아래 지도가 로드되지 않으면,
              <a className="underline text-emerald-900" href="https://map.naver.com/p/search/%EA%B4%91%EC%A3%BC%EA%B4%91%EC%97%AD%EC%8B%9C%20%EC%84%9C%EA%B5%AC%20%EC%83%81%EB%AC%B4%EB%8C%80%EB%A1%9C%2000" target="_blank" rel="noreferrer">네이버 지도에서 열기</a>
              를 눌러주세요.
            </p>
          </div>
          <div className="w-full h-[360px]">
            <iframe title="네이버지도" src="https://map.naver.com/v5/search/%EA%B4%91%EC%A3%BC%EA%B4%91%EC%97%AD%EC%8B%9C%20%EC%84%9C%EA%B5%AC%20%EC%83%81%EB%AC%B4%EB%8C%80%EB%A1%9C%2000" className="w-full h-full" loading="lazy"></iframe>
          </div>
        </div>
      </section>

      {/* 푸터 */}
      <footer className="border-t border-neutral-200">
        <div className="max-w-5xl mx-auto px-4 py-8 text-sm text-neutral-600">
          <div className="flex flex-wrap items-center gap-4 justify-between">
            <div>
              <div className="font-semibold text-neutral-800">누수·하수구 긴급센터</div>
              <div className="mt-1">사업자등록번호: 000-00-00000 · 대표: 홍길동</div>
              <div className="mt-1">광주광역시 서구 상무대로 00 (예시)</div>
            </div>
            <div className="text-right">
              <a href="tel:010-0000-0000" className="block">📞 010-0000-0000</a>
              <a href="mailto:info@example.com" className="block">✉️ info@example.com</a>
              <a href="https://pf.kakao.com/_yourchannel" target="_blank" rel="noreferrer" className="block">💬 카카오 채널</a>
            </div>
          </div>
          <p className="mt-4 text-xs">© {new Date().getFullYear()} 누수·하수구 긴급센터 — 모든 권리 보유.</p>
        </div>
      </footer>
    </div>
  );
}

// -------------------------
// ✅ Dev Test Cases (console)
// -------------------------
if (typeof window !== "undefined") {
  // Image template tests
  const beforeSrc = (i: number) => `/images/before-0${i}.jpg`;
  const afterSrc = (i: number) => `/images/after-0${i}.jpg`;
  [1, 2, 3, 4].forEach((i) => {
    console.assert(beforeSrc(i) === `/images/before-0${i}.jpg`, "beforeSrc template failed", i);
    console.assert(afterSrc(i) === `/images/after-0${i}.jpg`, "afterSrc template failed", i);
  });

  // Phone validation tests
  const okPhones = ["010-1234-5678", "010 1234 5678", "062-123-4567", "01012345678"]; // last one should fail because no hyphen/space but counts 11 digits (still passes regex if >=9) — confirm desired behavior with user
  const badPhones = ["0101234", "02", "abc-defg"]; 
  okPhones.forEach((p) => console.assert(PHONE_RE.test(p), "PHONE_RE should accept:", p));
  badPhones.forEach((p) => console.assert(!PHONE_RE.test(p), "PHONE_RE should reject:", p));
}
